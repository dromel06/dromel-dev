---
import { Image } from "astro:assets";
import imgLibelula from "../assets/imgs/libelula.png";
import { languageList } from "../i18n/ui";
import { useTranslation } from "../i18n/utils";

const formKey = import.meta.env.PUBLIC_WEB3FORMS_KEY;

const lang = Astro.currentLocale || "es";
const t = useTranslation(lang as keyof typeof languageList);
---

<section
    id="contact"
    class="relative py-12 bg-primary text-[#DCC9A9] text-center lg:max-w-2xl rounded-[30px] shadow-primary mx-8 lg:mx-auto shadow-md mb-16 px-8"
>
    <h2 class="text-3xl font-bold mb-4">{t("contact_contact")}</h2>
    <p class="mb-6">{t("contact_need")}</p>

    <div class="flex flex-collg:flex-row gap-8">
        <form class="lg:max-wlg space-y-4" id="form" method="post">
            <input type="hidden" name="access_key" value={formKey} />
            <input
                type="text"
                name="name"
                placeholder={t("contact_name")}
                class="w-full p-2 rounded text-black"
            />
            <input
                type="email"
                name="email"
                class="w-full p-2 rounded text-black"
                placeholder={t("contact_email")}
            />
            <textarea
                placeholder={t("contact_message")}
                name="message"
                class="w-full p-2 rounded text-black"></textarea>
            <button
                type="submit"
                class="bg-secondary text-accent px-6 py-2 rounded font-bold"
            >
                {t("contact_send")}
            </button>
        </form>

        <Image
            src={imgLibelula}
            alt="Contacto - persona trabajando en laptop"
            class="absolute w-24 lg:w-64 lg:top-0 -top-2 end-0 lg:-right-30 drop-shadow-sm lg:drop-shadow-primary drop-shadow-secondary mx-auto"
        />
    </div>

    <script type="text/javascript">
        document
            .getElementById("form")
            .addEventListener("submit", async function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                const submitButton = this.querySelector(
                    "button[type='submit']"
                );
                const originalText = submitButton.textContent;

                try {
                    submitButton.textContent = "Enviando...";
                    submitButton.disabled = true;
                    const response = await fetch(
                        "https://api.web3forms.com/submit",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Accept: "application/json",
                            },
                            body: JSON.stringify(Object.fromEntries(formData)),
                        }
                    );

                    const result = await response.json();

                    if (result.success) {
                        alert("El Mensaje se ha enviado Exitosamente!");
                        this.reset();
                    } else {
                        alert("Hubo un error al enviar el mensaje.");
                    }
                } catch (error) {
                    alert("Hubo un error al enviar el mensaje.");
                } finally {
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                }
            });
    </script>
</section>
